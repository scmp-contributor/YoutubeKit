<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="initial-scale={viewport-initial-scale}, user-scalable=no">
    <style>
      html, body { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000000; }
      div { position: absolute; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <iframe id="player"
     type="text/html" width="100%" height="100%"
     src="https://www.youtube.com/embed/{video-id}?{iframe-src-query-string}"
     frameborder="0">
   </iframe>
        <div id="pfp-container"></div>
        <script src="//imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <script src="https://www.youtube.com/iframe_api?ima=1" onerror="webkit.messageHandlers.onYouTubeIframeAPIFailedToLoad.postMessage('')"></script>
    <script>
        var player;
        var time;
        var imaManager;


    function onYouTubeIframeAPIReady() {
      console.log("[play.html] onYouTubeIframeAPIReady")
        YT.createPlayerForPublishers(
        'player',
        makeAdsRequest,
        {
        youtubeOptions: {player-options}
        },
        onPlayerReady);
    }

    function onStateChange(event) {
      console.log("[play.html] onStateChange")
        webkit.messageHandlers.onStateChange.postMessage(event.data);
    }
    function onPlaybackQualityChange(event) {
      console.log("[play.html] onPlaybackQualityChange")
        webkit.messageHandlers.onPlaybackQualityChange.postMessage(event.data);
    }
    function onPlaybackRateChange(event) {
      console.log("[play.html] onPlaybackRateChange")
        webkit.messageHandlers.onPlaybackRateChange.postMessage(event.data);
    }
    function onPlayerError(event) {
      console.log("[play.html] onPlayerError")
        webkit.messageHandlers.onError.postMessage(event.data);
    }
    function onApiChange(event) {
      console.log("[play.html] onApiChange")
        webkit.messageHandlers.onApiChange.postMessage(event.data);
    }
    function makeAdsRequest(adsRequest, adsRenderingSettings) {
      console.log("[play.html] makeAdsRequest")

      // Required
      adsRequest.adTagUrl = adsTagUrl;
      // Recommended
      adsRenderingsettings.useStyledNonLinearAds = true;
      // Optional: you can also update other properties of
      // the AdsRequest.
      // Optional: you can also update the adsRenderingSettings
      // object if needed.
      adsRenderingsettings.uiElements = [window.google.ima.UiElements.AD_ATTRIBUTION,
                                         window.google.ima.UiElements.COUNTDOWN];
    }
      // You can use a callback function if you want to do some
    // customization after the player is instantiated or you
    // want handles to the player and IMA manager.
    function onPlayerReady(plyr, ima) {
      console.log("[play.html] onPlayerReady")
        player = plyr;
        imaManager = ima;
        webkit.messageHandlers.onReady.postMessage('');
        webkit.messageHandlers.onYouTubeIframeAPIReady.postMessage('');

        const adsRenderingSettings = new google.ima.AdsRenderingSettings();
        adsRenderingSettings.enablePreloading(true);
        const adManager = imaManager.getAdsManager();
        adManager.updateAdsRenderingSettings(adsRenderingSettings);

        window.setInterval(updateTime, 500);
    }

    function updateTime() {
        var state = player.getPlayerState();
        if (state == YT.PlayerState.PLAYING) {
            time = player.getCurrentTime();
             webkit.messageHandlers.onUpdateCurrentTime.postMessage(time);
        }
    }
    </script>
</body>
</html>
